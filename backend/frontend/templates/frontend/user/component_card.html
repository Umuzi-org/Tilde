<!-- All svg icons are from: https://icones.js.org/ -->

{% load humanize %}

<div
    class="mb-3"
    id="card_{{ card.id }}" 
    data-status="{{card.status}}">
    <div class="border rounded-t-xl border-gray-300 py-2 px-4  flex justify-between items-center text-xs">
        <div>
            <p class="bold">
                {{ card.content_type_nice }} 
            </p>
        </div>
        {% if card.flavour_names %}
            <div class="flex gap-1 items-center flex-wrap"> 
                {% for flavour_name in card.flavour_names %}
                    {%if flavour_name != "none"%}
                        {%if flavour_name != "java" or flavour_name != "javascript" or flavour_name != "python"%}
                            <span class="{{styles.flavour_chip}} rounded-full border border-gray-300" title="{{flavour_name}}">
                                {{flavour_name|first}}
                            </span> 
                        {%endif%}
                        {%if flavour_name == "javascript"%}
                            <span class="{{styles.flavour_chip}}" title="{{flavour_name}}">
                                <svg  xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M3 3h18v18H3V3m4.73 15.04c.4.85 1.19 1.55 2.54 1.55c1.5 0 2.53-.8 2.53-2.55v-5.78h-1.7V17c0 .86-.35 1.08-.9 1.08c-.58 0-.82-.4-1.09-.87l-1.38.83m5.98-.18c.5.98 1.51 1.73 3.09 1.73c1.6 0 2.8-.83 2.8-2.36c0-1.41-.81-2.04-2.25-2.66l-.42-.18c-.73-.31-1.04-.52-1.04-1.02c0-.41.31-.73.81-.73c.48 0 .8.21 1.09.73l1.31-.87c-.55-.96-1.33-1.33-2.4-1.33c-1.51 0-2.48.96-2.48 2.23c0 1.38.81 2.03 2.03 2.55l.42.18c.78.34 1.24.55 1.24 1.13c0 .48-.45.83-1.15.83c-.83 0-1.31-.43-1.67-1.03l-1.38.8Z"/></svg>
                            </span> 
                        {%endif%}
                        {%if flavour_name == "python"%}
                            <span class="{{styles.flavour_chip}}" title="{{flavour_name}}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M19.14 7.5A2.86 2.86 0 0 1 22 10.36v3.78A2.86 2.86 0 0 1 19.14 17H12c0 .39.32.96.71.96H17v1.68a2.86 2.86 0 0 1-2.86 2.86H9.86A2.86 2.86 0 0 1 7 19.64v-3.75a2.85 2.85 0 0 1 2.86-2.85h5.25a2.85 2.85 0 0 0 2.85-2.86V7.5h1.18m-4.28 11.79c-.4 0-.72.3-.72.89c0 .59.32.71.72.71a.71.71 0 0 0 .71-.71c0-.59-.32-.89-.71-.89m-10-1.79A2.86 2.86 0 0 1 2 14.64v-3.78A2.86 2.86 0 0 1 4.86 8H12c0-.39-.32-.96-.71-.96H7V5.36A2.86 2.86 0 0 1 9.86 2.5h4.28A2.86 2.86 0 0 1 17 5.36v3.75a2.85 2.85 0 0 1-2.86 2.85H8.89a2.85 2.85 0 0 0-2.85 2.86v2.68H4.86M9.14 5.71c.4 0 .72-.3.72-.89c0-.59-.32-.71-.72-.71c-.39 0-.71.12-.71.71s.32.89.71.89Z"/></svg>                            
                            </span> 
                        {%endif%}
                        {%if flavour_name == "java"%}
                            <span class="{{styles.flavour_chip}}" title="{{flavour_name}}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 128 128"><path fill="currentColor" d="M47.617 98.12c-19.192 5.362 11.677 16.439 36.115 5.969c-4.003-1.556-6.874-3.351-6.874-3.351c-10.897 2.06-15.952 2.222-25.844 1.092c-8.164-.935-3.397-3.71-3.397-3.71zm33.189-10.46c-14.444 2.779-22.787 2.69-33.354 1.6c-8.171-.845-2.822-4.805-2.822-4.805c-21.137 7.016 11.767 14.977 41.309 6.336c-3.14-1.106-5.133-3.131-5.133-3.131zm11.319-60.575c.001 0-42.731 10.669-22.323 34.187c6.024 6.935-1.58 13.17-1.58 13.17s15.289-7.891 8.269-17.777c-6.559-9.215-11.587-13.793 15.634-29.58zm9.998 81.144s3.529 2.91-3.888 5.159c-14.102 4.272-58.706 5.56-71.095.171c-4.45-1.938 3.899-4.625 6.526-5.192c2.739-.593 4.303-.485 4.303-.485c-4.952-3.487-32.013 6.85-13.742 9.815c49.821 8.076 90.817-3.637 77.896-9.468zM85 77.896c2.395-1.634 5.703-3.053 5.703-3.053s-9.424 1.685-18.813 2.474c-11.494.964-23.823 1.154-30.012.326c-14.652-1.959 8.033-7.348 8.033-7.348s-8.812-.596-19.644 4.644C17.455 81.134 61.958 83.958 85 77.896zm5.609 15.145c-.108.29-.468.616-.468.616c31.273-8.221 19.775-28.979 4.822-23.725c-1.312.464-2 1.543-2 1.543s.829-.334 2.678-.72c7.559-1.575 18.389 10.119-5.032 22.286zM64.181 70.069c-4.614-10.429-20.26-19.553.007-35.559C89.459 14.563 76.492 1.587 76.492 1.587c5.23 20.608-18.451 26.833-26.999 39.667c-5.821 8.745 2.857 18.142 14.688 28.815zm27.274 51.748c-19.187 3.612-42.854 3.191-56.887.874c0 0 2.874 2.38 17.646 3.331c22.476 1.437 57-.8 57.816-11.436c.001 0-1.57 4.032-18.575 7.231z"/></svg>                            
                            </span> 
                        {%endif%}
                    {%endif%}
                {% endfor %}
            </div>
        {% endif %}
    </div>
    
    <div class="border rounded-b-xl border-gray-300 border-t-0 p-4 flex flex-col gap-3">
    {% if card.status == "IP" or card.status == "RF"%}
        {% if card.open_pr_count and card.oldest_open_pr_updated_time%}
            <div class="flex" title="Open PRs and their last update time">
                <div class="flex gap-2 items-center border p-2 bg-blue-200 border-blue-500 rounded-lg mb-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 14 14"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="m10 3.5l-3-3l-3 3m7 10a4 4 0 0 1-4-4a4 4 0 0 1-4 4m4-4v-9"/></svg>
                    <p class="text-xs">
                        Updated {{card.oldest_open_pr_updated_time|naturaltime}} 
                    </p>
                </div>
                <div class="{{styles.good_review_counter_chip}}">{{card.open_pr_count}}</div> 
            </div>
        {% endif %}
    {% endif %}

    {% if card.status == "IR" and card.review_request_time%}
        <div class="flex gap-2 border p-2 bg-blue-200 border-blue-500 rounded-lg mb-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M11 9h2V7h-2m1 13c-4.41 0-8-3.59-8-8s3.59-8 8-8s8 3.59 8 8s-3.59 8-8 8m0-18A10 10 0 0 0 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2m-1 15h2v-6h-2v6Z"/></svg>            
            <p class="text-xs">
                Review requested {{card.review_request_time|naturaltime}} 
            </p>
        </div>
    {% endif %}

    {% if card.status == "RF" or card.status == "IR" or card.status == "C" %}
        <div class="flex">
            {% if card.code_review_competent_since_last_review_request %}
                <div class="flex" title="Number of competent code reviews since last review request">
                    <div> 
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M20 12a8 8 0 0 0-8-8a8 8 0 0 0-8 8a8 8 0 0 0 8 8a8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12A10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5S7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5S14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg>
                    </div>
                    <div class="{{styles.good_review_counter_chip}}">
                        {{card.code_review_competent_since_last_review_request}} 
                    </div>
                </div>    
            {% endif %}
            {% if card.code_review_excellent_since_last_review_request %}
                <div class="flex" title="Number of competent code reviews since last review request">
                    <div title="Number of excellent code reviews since last review request">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M19 10c0 1.38-2.12 2.5-3.5 2.5s-2.75-1.12-2.75-2.5h-1.5c0 1.38-1.37 2.5-2.75 2.5S5 11.38 5 10h-.75c-.16.64-.25 1.31-.25 2a8 8 0 0 0 8 8a8 8 0 0 0 8-8c0-.69-.09-1.36-.25-2H19m-7-6C9.04 4 6.45 5.61 5.07 8h13.86C17.55 5.61 14.96 4 12 4m10 8a10 10 0 0 1-10 10A10 10 0 0 1 2 12A10 10 0 0 1 12 2a10 10 0 0 1 10 10m-10 5.23c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg> 
                    </div>
                    <div class="{{styles.good_review_counter_chip}}">{{card.code_review_excellent_since_last_review_request}} 
                    </div>
                </div>
            {% endif %}
            {% if card.code_review_ny_competent_since_last_review_request %}
                <div class="flex" title="Number of competent code reviews since last review request">
                    <div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M20 12a8 8 0 0 0-8-8a8 8 0 0 0-8 8a8 8 0 0 0 8 8a8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12A10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5s-1.5-.7-1.5-1.5s.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5S7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg>
                    </div>
                    <div class="{{styles.bad_review_counter_chip}}">{{card.code_review_ny_competent_since_last_review_request}} 
                    </div>
                </div>
            {% endif %}
            {% if card.code_review_red_flag_since_last_review_request %}
                <div class="flex" title="Number of competent code reviews since last review request">
                    <div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M7.57 20c-1.34 0-2.43-1.09-2.43-2.43c0-1.07 1.18-3.07 2.43-4.76C8.82 14.5 10 16.5 10 17.57A2.43 2.43 0 0 1 7.57 20M12 2A10 10 0 0 0 2 12c0 1.75.45 3.38 1.24 4.81c.16-.81.57-1.74 1.07-2.64A7.69 7.69 0 0 1 4 12a8 8 0 0 1 8-8a8 8 0 0 1 8 8a8 8 0 0 1-8 8c-.24 0-.47 0-.71-.04c-.47.74-1.15 1.32-1.95 1.67c.85.24 1.74.37 2.66.37a10 10 0 0 0 10-10A10 10 0 0 0 12 2m0 12c-.41 0-.81.04-1.19.12c.35.63.66 1.28.88 1.88H12c1.25 0 2.32.5 2.77 1.23l1.42-1.42C15.29 14.72 13.75 14 12 14m3.5-6c-.8 0-1.5.7-1.5 1.5s.7 1.5 1.5 1.5s1.5-.7 1.5-1.5S16.3 8 15.5 8M10 9.5C10 8.7 9.3 8 8.5 8S7 8.7 7 9.5S7.7 11 8.5 11s1.5-.7 1.5-1.5"/></svg>
                    </div>                
                    <div class="{{styles.bad_review_counter_chip}}">{{card.code_review_red_flag_since_last_review_request}} 
                    </div>
                </div>    
            {% endif %}
        </div>
    {% endif %}

    <h3 
        class="{{ styles.heading3 }}">
        {{ card.title }}
    </h3>

    {% if card.tag_names %}
        <div class="flex gap-2 items-center flex-wrap">
            {% for tag_name in card.tag_names %}
                <span class="flex px-2 py-1 rounded-full border border-gray-300 text-xs">{{tag_name}}</span> 
            {% endfor %}
        </div>
    {% endif %}

    {% if card.due_time %}
        <div class="flex gap-2" title="Due time">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12 20a7 7 0 0 1-7-7a7 7 0 0 1 7-7a7 7 0 0 1 7 7a7 7 0 0 1-7 7m0-16a9 9 0 0 0-9 9a9 9 0 0 0 9 9a9 9 0 0 0 9-9a9 9 0 0 0-9-9m.5 4H11v6l4.75 2.85l.75-1.23l-4-2.37V8M7.88 3.39L6.6 1.86L2 5.71l1.29 1.53l4.59-3.85M22 5.72l-4.6-3.86l-1.29 1.53l4.6 3.86L22 5.72Z"/></svg>
            {% now "U" as current_timestamp %}
            {% if current_timestamp > card.due_time|date:"U" %}
                <p class="text-red-600">
                    {{card.due_time|naturalday}}, {{card.due_time|time}} 
                </p>
                {% else %}
                <p>
                    {{card.due_time|naturalday}}, {{card.due_time|time}} 
                </p>
            {% endif %}
        </div>
    {% endif %}
    
    {% if card.request_user_is_assignee == False %}
        <div class="w-full" >
            <p class="{{styles.small_bold_text}}">Assignee</p>
            <p class="truncate" title="{{card.assignee_names.0}}">{{card.assignee_names.0}}</p> 
        </div>
    {% endif %}

    {% if card.reviewer_names %}
        <div class="w-full">
            <p class="{{styles.small_bold_text}}">Reviewers</p>
            {% for reviewer_name in card.reviewer_names %}
                <p class="truncate" title="{{reviewer_name}}">{{reviewer_name}}</p> 
            {% endfor %}
        </div>
    {% endif %}

    {% if card.repo_url %}
        <div class="flex gap-1">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33c.85 0 1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg>
            <a class="{{styles.link}}" target="_blank" href="{{card.recruit_project.repository.get_github_repo_link}}">Repository</a>  
        </div>
    {% endif %}

    {% if card.request_user_can_start %}
        <button type="button" class="{{ styles.button_primary_small }}"
            hx-post="{% url 'action_start_card' card.id %}"
            hx-target="#card_{{ card.id }}"
            hx-swap="outerHTML"
            >Start
        </button>
    {% endif %}
    </div>
</div>
