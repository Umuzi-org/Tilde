{% extends "frontend/project_review_coordination/base.html" %}

{% block heading %}Unclaimed bundles{% endblock %}


{% block main %}

    {% for bundle in bundles %}
    <div x-data="{ bundleExpanded: false }" id="bundle_{{ forloop.counter0 }}" 
    class="mb-3 p-2 rounded-xl border-2 relative {% if bundle.is_trusted %}border-indigo-300{% endif %}"
    >
    <div>
        <h3 class="font-bold inline-block">{{ bundle.title }}</h3> {{ bundle.flavours }} 
        <form method="post">
            {% csrf_token %}
            <button
                x-show="bundleExpanded"
                x-on:click="bundleExpanded = false"
                class="{{ styles.button_secondary_small }}"
            >
                Collapse
            </button>
            <button
                class="{{ styles.button_primary_small }}"
                x-show="!bundleExpanded"
                x-on:htmx:after-request="bundleExpanded = true"
                hx-vals='js:{project_ids: {{ bundle.project_ids }} }'
                hx-trigger="click"
                hx-target="#bundle_{{ forloop.counter0 }}_drilldown"
                hx-swap="innerHTML"
                hx-post="{% url 'view_partial_bundle_expanded' %}"
            >
                Expand
            </button>
        </form>
    </div>
    <div>
        {{ bundle.tags }}
    </div>
    {% if bundle.is_trusted %} 
    <div 
        class="absolute top-0 right-0 bg bg-yellow-200 text-xs text-black py-1 px-2 mt-2 mr-2 border-2 border-yellow-300 rounded-full"
        title="You are trusted on these projects"
    >
        trusted
    </div>
    {% endif %}
        Number of cards = {{ bundle.card_count }}
        <br/>
        <div x-show="bundleExpanded" id="bundle_{{ forloop.counter0 }}_drilldown"></div>

        <br/>
        Oldest review request time: {{ bundle.oldest_review_request_time | date:"r"}}
        <br/>

        <form>
                {% csrf_token %}

                <button
                hx-trigger="click"
                hx-target="#bundle_{{ forloop.counter0 }}"
                hx-swap="outerHTML"
                hx-post="{% url 'action_project_review_coordination_claim_bundle' %}"
                
                hx-vals='js:{project_ids: {{ bundle.project_ids }} }'
                class="{{ styles.button_primary_small }}"
                >Claim</button>
            </form>
        </div>
    {% endfor %}

{% endblock %}